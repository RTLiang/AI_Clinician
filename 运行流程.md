# 运行流程
## 环境配置
### MATLAB 环境
1. 安装 [MATLAB](https://www.mathworks.com/downloads/matlab) （R2025b 可运行本项目）
2. 安装以下工具箱
    ```
    Statistics and Machine Learning Toolbox
    Bioinformatics Toolbox
    Parallel Computing Toolbox
    Curve Fitting Toolbox
    ```
    [rotateXLabels](https://www.mathworks.com/matlabcentral/fileexchange/27812-rotatexlabels-ax-angle-varargin)
### 数据库相关
1. Postgres database：可根据 [https://mimic.mit.edu/docs/gettingstarted/local/](https://mimic.mit.edu/docs/gettingstarted/local/) 内相关文档安装 Postgres database 

2. MIMIC-III 原始数据，详见 [https://mimic.mit.edu/docs/gettingstarted/local/](https://mimic.mit.edu/docs/gettingstarted/local/)

3. 安装获取 eICU-CRD 数据库，详见 [https://eicu-crd.mit.edu/gettingstarted/dbsetup/](https://eicu-crd.mit.edu/gettingstarted/dbsetup/)

4. 安装 [Python](https://www.python.org/downloads/) 环境以及 [Jupyter Notebook](https://jupyter.org/install) 用于从 Postgres database 抽取数据 

## 数据抽取
1. 创建虚拟环境
```bash
python -m venv .venv
```
2. 切换至虚拟环境
```bash
# Linux/macOS
source .venv/bin/activate

# Windows
.venv\Scripts\activate.bat
```
3. 安装相应依赖
```bash
pip install -r requirements.txt
```
4. 按照 [AIClinician_Data_extract_MIMIC3_140219.ipynb](./AIClinician_Data_extract_MIMIC3_140219.ipynb) 相应流程抽取 MIMIC 数据，保存在 `exportdir` 目录内

5. 运行 [eicu_feature_pipeline.py](./eicu_feature_pipeline.py) 抽取 eICU-CRD 数据： `eicu_features.csv` 以及 `eicu_features.mat`，保存在 `exportdir/eicu` 目录内

## MATLAB脚本
1. 创建 BACKUP 文件夹用于存放中间数据 
```bash
mkdir BACKUP
```
2. 定义 Sepsis-3 队列：运行 `AIClinician_sepsis3_def_160219.m` 注：本脚本需要安装 `Statistics and Machine Learning Toolbox` 以及 `Bioinformatics Toolbox`，得到中间文件 `AIClinician_sepsis3_def_160219.mat`

3. 重新构建分析数据集：运行 `AIClinician_mimic3_dataset_160219.m`，得到中间文件 `dataset_before_combination.mat`，`dataset_after_combination.mat`，`MIMICtable.mat`

4. 构建 eICU-CRD 数据集：运行 `scripts/build_eICUtable.m`，得到可用文件 `eICUtable_ready.mat` 注：可能要将 `scripts` 加入 MATLAB 的路径中

5. 训练模型：运行 `AIClinician_core_160219.m`，该脚本出现UI提醒是否加载保存点，若无保存点，点击 NO 并找到交互窗口（可能被隐藏）开始训练
